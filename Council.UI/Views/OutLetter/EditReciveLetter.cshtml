@model Council.Core.Entities.OutLetter

@{
    ViewBag.Title = "ویرایش";
    Layout = "~/Views/Shared/_Layout.cshtml";

}
@{
    var organs = ViewBag.Organs as List<Council.Core.Entities.Organ>;
}

<div class="card">
    <div class="card-header">
        ویرایش
    </div>
    @using (Html.BeginForm(null, null, FormMethod.Post, new { enctype = "multipart/form-data", @id = "letterForm" }))
    {
<div class="card-body">
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    @Html.HiddenFor(model => model.ID)
    @Html.HiddenFor(model => model.Received)
    @Html.HiddenFor(model => model.OutLetterNumber)
    <input name="letterType" type="hidden" value="1" />
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    <div class="row form-group">
        <div class="col-md-12">
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="radioLetter" checked="checked">
                <label class="form-check-label radio-inline control-label">نامه</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="radioPlan">
                <label class="form-check-label radio-inline control-label">طرح</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="radioRule">
                <label class="form-check-label radio-inline control-label">لایحه</label>
            </div>
        </div>
    </div>
    <div class="row form-group">
        <div class="col-md-12">
            <div id="forceDiv" style="display:none">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="oneForce" checked="checked">
                    <label class="form-check-label radio-inline control-label">تک فوریتی</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="twoForce">
                    <label class="form-check-label radio-inline control-label">دو فوریتی</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="threeForce">
                    <label class="form-check-label radio-inline control-label"> سه فوریتی</label>
                </div>
            </div>
        </div>
    </div>
    <input name="letterType" type="hidden" value="1" />
    <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="row form-group">
                @Html.LabelFor(model => model.Subject, htmlAttributes: new { @class = "control-label col-lg-4 col-md-4 col-sm-12 col-12" })
                <div class="col-lg-8 col-md-8 col-sm-12 col-12">
                    @Html.EditorFor(model => model.Subject, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Subject, null, new { @class = "text-danger" })
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="row form-group">
                @Html.LabelFor(model => model.OutLetterNumber, htmlAttributes: new { @class = "control-label col-lg-4 col-md-4 col-sm-12 col-12" })
                <div class="col-lg-8 col-md-8 col-sm-12 col-12">
                    @Html.DisplayFor(model => model.OutLetterNumber, new { htmlAttributes = new { @class = "form-control" } })

                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="row form-group">
                @Html.LabelFor(model => model.RegisterNumber, htmlAttributes: new { @class = "control-label col-lg-4 col-md-4 col-sm-12 col-12" })
                <div class="col-lg-8 col-md-8 col-sm-12 col-12">
                    @Html.EditorFor(model => model.RegisterNumber, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.RegisterNumber, null, new { @class = "text-danger" })
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="row form-group">
                @Html.LabelFor(model => model.OutLetterDate, htmlAttributes: new { @class = "control-label col-lg-4 col-md-4 col-sm-12 col-12" })
                <div class="col-lg-8 col-md-8 col-sm-12 col-12">
                    @Html.EditorFor(model => model.OutLetterDate, new { htmlAttributes = new { @class = "form-control text-box allowDatePicker", autocomplete = "off" } })
                    @Html.ValidationMessageFor(model => model.OutLetterDate, null, new { @class = "text-danger" })
                </div>
            </div>
        </div>

    </div>
    <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="row form-group">
                @Html.LabelFor(model => model.Sender, htmlAttributes: new { @class = "control-label col-lg-4 col-md-4 col-sm-12 col-12" })
                <div class="col-lg-8 col-md-8 col-sm-12 col-12">
                    @Html.EditorFor(model => model.Sender, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Sender, null, new { @class = "text-danger" })
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="row form-group">
                @Html.LabelFor(model => model.Bringer, htmlAttributes: new { @class = "control-label col-lg-4 col-md-4 col-sm-12 col-12" })
                <div class="col-lg-8 col-md-8 col-sm-12 col-12">
                    @Html.EditorFor(model => model.Bringer, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.Bringer, null, new { @class = "text-danger" })
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="row form-group">
                @Html.LabelFor(model => model.LinkedLetters, htmlAttributes: new { @class = "control-label col-lg-4 col-md-4 col-sm-12 col-12" })
                <div class="col-lg-8 col-md-8 col-sm-12 col-12">
                    @Html.EditorFor(model => model.LinkedLetters, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.LinkedLetters, null, new { @class = "text-danger" })
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="row form-group">
                @Html.LabelFor(model => model.OrginalLetter, htmlAttributes: new { @class = "control-label col-lg-4 col-md-4 col-sm-12 col-12" })
                <div class="col-lg-8 col-md-8 col-sm-12 col-12">
                    @Html.EditorFor(model => model.OrginalLetter, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.OrginalLetter, null, new { @class = "text-danger" })
                </div>
            </div>
        </div>


    </div>
    <div class="row">

        <div class="col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="row form-group">
                @Html.LabelFor(model => model.BoxNumber, htmlAttributes: new { @class = "control-label col-lg-4 col-md-4 col-sm-12 col-12" })
                <div class="col-lg-8 col-md-8 col-sm-12 col-12">
                    @Html.EditorFor(model => model.BoxNumber, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.BoxNumber, null, new { @class = "text-danger" })
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-12 col-12">
            <div class="row form-group">
                @Html.LabelFor(model => model.ArchiveCode, htmlAttributes: new { @class = "control-label col-lg-4 col-md-4 col-sm-12 col-12" })
                <div class="col-lg-8 col-md-8 col-sm-12 col-12">
                    @Html.EditorFor(model => model.ArchiveCode, new { htmlAttributes = new { @class = "form-control" } })
                    @Html.ValidationMessageFor(model => model.ArchiveCode, null, new { @class = "text-danger" })
                </div>
            </div>
        </div>
    </div>
    <div class="row">

        <div class="col-lg-6 col-md-6 col-sm-12 col-12 form-group">
            <div class="row form-group">
                @Html.LabelFor(model => model.Organ, htmlAttributes: new { @class = "control-label col-lg-4 col-md-4 col-sm-12 col-12" })
                <div class="col-lg-8 col-md-8 col-sm-12 col-12">
                    <select id="Organ" name="Organ" class="form-control" required="required">
                        @foreach (var item in organs)
                        {
                            if (item.ID == Model.Organ.ID)
                            {
                                <option value="@item.ID" selected="selected">@item.Name</option>
                            }
                            else
                            {
                                <option value="@item.ID">@item.Name</option>
                            }
                        }
                    </select>
                    @Html.ValidationMessageFor(model => model.Organ, null, new { @class = "text-danger" })
                </div>
            </div>
        </div>
    </div>
    <div class="row form-group">
        @Html.Label("توضیحات / متن", htmlAttributes: new { @class = "control-label col-lg-2 col-md-2 col-sm-6 col-12" })
        <div class="col-lg-10 col-md-10 col-sm-6 col-12">
            @Html.EditorFor(model => model.Comment, new { htmlAttributes = new { @class = "form-control" } })
            @Html.ValidationMessageFor(model => model.Comment, null, new { @class = "text-danger" })
        </div>
    </div>
    <div class="row">
        <div class="col-lg-2 col-md-2 col-sm-6 col-12"></div>
        <div class="col-lg-10 col-md-10 col-sm-6 col-12">
            @if ((!String.IsNullOrEmpty(Model.Files)) || (Model.Uploads != null && Model.Uploads.Count != 0))
            {
                var counter = 1;
                if (!String.IsNullOrEmpty(Model.Files))
                {
                    <a id="attachment" href="@(Url.Content("~" + Model.Files))">[ فایل ضمیمه @counter ]</a>
                    counter++;
                }
                foreach (var item in Model.Uploads)
                {
                    <a href="@(Url.Content("~" + item.FileAddress))">[ فایل ضمیمه @counter ]</a>
                    counter++;
                }
            }
            <br />
            @*<a class="btn btn-info" onclick="document.getElementById('inputFile').click(); return false;"> انتخاب فایل ضمیمه</a>
                <input type="file" accept="image/png, image/jpeg, image/gif" class="hidden" name="file" id="inputFile" value="انتخاب" />
                <span></span>*@
            <div id="uploads">
            </div>
            <a class="btn btn-sm btn-primary" id="addNewUpload"><i>اضافه کردن فایل</i></a>
            @*<button id="addNewUpload" class="btn btn-default">اضافه کردن فایل</button>*@
            <br /><br />
        </div>
    </div>
</div>
        <div class="card-footer">
            <input type="submit" value="ذخیره" class="btn btn-success" />
            @Html.ActionLink("بازگشت", "ShowOutLetters", "OutLetter", null, new { @class = "btn btn-sm btn-primary" })
        </div>
    }
</div>

@section scripts{
    <script src="~/Content/tinymce/tinymce.min.js"></script>
    <script src="~/Scripts/scripts.js"></script>
    <script type="text/javascript">
        tinymce.init({
            selector: "textarea",
            setup: function (ed) {
                ed.on('init', function () {
                    this.execCommand("fontSize", false, "18px");
                });
            },
            directionality: 'rtl',
            theme: "modern",
            theme_modern_font_sizes: ["6px,7px,8px,9px,10px,11px,12px,13px,14px,15px,16px,17px,18px,19px,20px,21px,22px,23px,24px,25px,26px,27px,28px,29px,30px,31px,32px,36px,38px,40px"],
            theme_advanced_buttons1: "save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,fontselect,fontsizeselect",
            theme_advanced_buttons2: "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor",
            theme_advanced_buttons3: "tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,iespell,media,advhr,|,print,|,ltr,rtl,|,fullscreen",

            plugins: [
                "advlist autolink lists link image charmap print preview anchor",
                "searchreplace visualblocks code fullscreen",
                "insertdatetime media table contextmenu paste"
            ],
            toolbar: "forecolor backcolor | insertfile undo redo | fontsizeselect | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image"
        });
   

        //$("#Subject").addClass("textBox-overwidth");
        //$("textarea").css("height", "60px");
        //$("textarea").css("width", "85%");
        //if ($("input[name='radioRule']").prop("checked")) {
        //    $("input[name='oneForce']").prop("checked", true)
        //    $("input[name='letterType']").val('4');
        //    if ($("input[name='oneForce']").prop("checked"))
        //        $("input[name='letterType']").val('4');
        //    if ($("input[name='twoForce']").prop("checked"))
        //        $("input[name='letterType']").val('5');
        //    if ($("input[name='threeForce']").prop("checked"))
        //        $("input[name='letterType']").val('6');
        //}
        //if ($("input[name='radioPlan']").prop("checked")) {
        //    $("input[name='letterType']").val('2');
        //}
        //$("#submitLetter").click(function () {
        //
        //    var erroMessage = "";
        //    if ($("select[name=Organ]").val() == '' || $("select[name=Subject]").val()=='' || $("select[name=OutLetterNumber]").val()=='' || $("select[name=OutLetterDate]").val()=='' || $("select[name=SendDate]").val()=='') {
        //        if ($("select[name=Organ]").val() == '' || $("select[name=Organ]").val() == undefined)
        //            erroMessage += 'لطفا سازمان را انتخاب کنید' + '\n';
        //        if ($("select[name=Subject]").val() == '' || $("select[name=Subject]").val() == undefined)
        //            erroMessage += 'لطفا موضوع نامه را وارد کنید' + '\n';
        //        if ($("select[name=OutLetterNumber]").val() == '' || $("select[name=OutLetterNumber]").val() == undefined)
        //            erroMessage += 'لطفا شماره نامه را وارد کنید' + '\n';
        //        if ($("select[name=OutLetterDate]").val() == '' || $("select[name=OutLetterDate]").val() == undefined)
        //            erroMessage += 'لطفا تاریخ نامه را وارد کنید' + '\n';
        //        if ($("select[name=SendDate]").val() == '' || $("select[name=SendDate]").val() == undefined)
        //            erroMessage += 'لطفا تاریخ ثبت نامه را وارد کنید' + '\n';
        //        $("#errorMessage").text(erroMessage);
        //        $("#errorMessage").html(this.html().replace(/\n/g, '<br/>'));
        //    }
        //    else {

        //        $("#letterForm").submit();
        //    }
        //})

        $("input[name='oneForce']").click(function () {
            $("input[name='twoForce']").prop("checked", false);
            $("input[name='threeForce']").prop("checked", false);
            $("input[name='letterType']").val('4');
        });
        $("input[name='twoForce']").click(function () {
            $("input[name='oneForce']").prop("checked", false);
            $("input[name='threeForce']").prop("checked", false);
            $("input[name='letterType']").val('5');
        });
        $("input[name='threeForce']").click(function () {
            $("input[name='oneForce']").prop("checked", false);
            $("input[name='twoForce']").prop("checked", false);
            $("input[name='letterType']").val('6');
        });

        $("input[name='radioLetter']").click(function () {
            $("input[name='radioPlan']").prop("checked", false);
            $("input[name='radioRule']").prop("checked", false);
            $("input[name='oneForce']").prop("checked", false);
            $("input[name='twoForce']").prop("checked", false);
            $("input[name='threeForce']").prop("checked", false);
            $("input[name='letterType']").val('1');
            $("#forceDiv").hide();
        });
        $("input[name='radioPlan']").click(function () {
            $("input[name='radioLetter']").prop("checked", false);
            $("input[name='radioRule']").prop("checked", false);
            $("input[name='radioPlan']").prop("checked", true);
            $("input[name='oneForce']").prop("checked", false);
            $("input[name='twoForce']").prop("checked", false);
            $("input[name='threeForce']").prop("checked", false);
            $("input[name='letterType']").val('2');
            $("#forceDiv").hide();
        });
        $("input[name='radioRule']").click(function () {
            $("input[name='oneForce']").prop("checked", true)
            $("input[name='letterType']").val('4');
            $("input[name='radioLetter']").prop("checked", false);
            $("input[name='radioPlan']").prop("checked", false);
            $("#forceDiv").toggle();
        });
    </script>
}