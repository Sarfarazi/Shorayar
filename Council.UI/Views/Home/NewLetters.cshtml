@model Council.Core.Models.HomePageViewModel
@using Microsoft.AspNet.Identity;
@using Council.Core.Enums;
@using Council.Core.Statics;
@{
    ViewBag.Title = "مکاتبات من";
    
    bool userIsBoss = Model != null? Model.UserIsBoss:false;
    bool userIsBossHelper = Model != null? Model.UserIsBossHelper:false;
    bool userIsSiteManager = Model != null? Model.UserIsSiteManager:false;
    bool userIsMember = Model != null? Model.UserIsMember:false;
}

<div class="customDiv">
    <div class="row">
        <div class="col-lg-8">
            <h4>@string.Format("به سیستم اتوماسیون و رای گیری شورای شهر {0} خوش آمدید!", Settings.CityName)</h4>
        </div>
        <div class="col-lg-4" style="direction:ltr">
           @using (Html.BeginForm("SearchResult","Home", FormMethod.Post))
            {
                <div id="searchDiv">
                    <input id="searchText" type="text" name="searchTxt" required="required" placeholder="جستجو در سایت">
                    <button type="submit" class="btn btn-default" style="height: 30px;"><span class='glyphicon glyphicon-search' ></span></button>              
                </div>
            }           
        </div>
    </div>
    
    @*<div class="inline-show">
        
    </div>*@
    
</div>

<div class="customDiv ">
    <div class="row">
        <div class="process-step col-mdd-2 col-sm-4 col-xs-4 ">
            <a href="/OutLetter/ShowOutLetters" class="btn btn-default btn-circle"><i class="glyphicon glyphicon-edit"></i></a>
            <p>  دریافتی / ارسالی</p>
        </div>
        <div class="process-step col-mdd-2 col-sm-4 col-xs-4">
            <a href="/Home/NewLetters" class="btn btn-default btn-circle"><i class="glyphicon glyphicon-list-alt"></i></a>
            <p>مکاتبات من</p>
        </div>
        <div class="process-step col-mdd-2 col-sm-4 col-xs-4 ">
            <a href="/OutLetter/ShowPlanLawsLetters" class="btn btn-default btn-circle"><i class="glyphicon glyphicon-credit-card"></i></a>
            <p>لوایح / طرحها</p>
        </div>
        <div class="process-step col-mdd-2 col-sm-4 col-xs-4 ">
            <a href="/Home/CouncilVoted" class="btn btn-default btn-circle"><i class="glyphicon glyphicon-book"></i></a>
            <p>آخرین رای گیری شورا</p>
        </div>
        <div class="process-step col-mdd-2 col-sm-4 col-xs-4">
            <a href="/Rule/Index?skip=0&take=50" class="btn btn-default btn-circle"><i class="glyphicon glyphicon-align-center"></i></a>
            <p>مصوبات</p>
        </div>      
        <div class="process-step col-mdd-2 col-sm-4 col-xs-4">
            <a href="/Letter" class="btn btn-default btn-circle"><i class="glyphicon glyphicon-file"></i></a>
            <p> نامه جدید</p>
        </div>
        <div class="process-step col-mdd-2 col-sm-4 col-xs-4">
            <a href="/Letter/Display?skip=0&take=50" class="btn btn-default btn-circle"><i class="glyphicon glyphicon-envelope"></i></a>
            <p>نمایش نامه ها</p>
        </div>
        <div class="process-step col-mdd-2 col-sm-4 col-xs-4">
            <a class="btn btn-default btn-circle" id="refreshPage"><i class="glyphicon glyphicon-refresh"></i></a>
            <p>بارگزاری مجدد</p>
        </div>

        @*<div class="process-step col-md-2 col-sm-4 col-xs-6">
            <a href="javascript:document.getElementById('logoutForm').submit()" class="btn btn-default btn-circle"><i class="glyphicon glyphicon-log-out"></i></a>
            <p>خروج</p>
        </div>*@
    </div>
</div>
@*@if (ViewBag.RoleName != "Admin")
{*@
<div class="row">

    <div class="col-md-12">
        <div class="customDiv">
            <div class="letter">
                <h4>مکاتبات جدید من</h4><hr />
                <table class="table table-bordered table-condensed table-hover table-responsive table-striped allletters">
                    <thead>
                        <tr>
                            <td class="table-heade-rowNumber">ردیف</td>
                            <td>شماره نامه</td>
                            <td>موضوع</td>
                            <td class="third-width">نوع نامه</td>
                            <td class="third-width"></td>
                        </tr>
                    </thead>
                    <tbody class="NewLettersUl">
                        @Html.Action("GetNewLetters")
                    </tbody>
                </table>
                <div id="ExtraLetters" class="row text-center">
                    <div class="col-lg-9 comm"><span> نمایش <span id="AnyLetterSpan"></span> از <span id="AllLetterSpan"></span></span></div>
                    <div class="col-lg-3 comm-left">
                        <span id="SpanAllLettersLink"><a id="MoreLetters" href="#">اطلاعات بیشتر</a> / <a id="AllLettersLink" href="#">نمایش همه</a></span>
                    </div>
                </div>
            </div>            
        </div>
    </div>
    
    

</div>

<script type='text/javascript'>
      // When your page loads
      $(function(){
         // When the toggle areas in your navbar are clicked, toggle them
         $("#search-button, #search-icon").click(function(e){
             e.preventDefault();
             $("#search-button, #search-form").toggle();
         });
      })
</script>
<script>
    
    var allLetterPageNumber = 1;   
    var letterId = "";
    
    $(document).ready(function () {
        if ($("tbody.NewLettersUl tr").length == 0) {
            $("#ExtraLetters").hide();
            $("tbody.NewLettersUl").parent().parent().parent().hide()
            //$("tbody.NewLettersUl").parent().parent().hide();
        } else {
            if (Number($("#AllLettersCount").val()) <= 50)
                $("#SpanAllLettersLink").hide();
            document.getElementById('AllLetterSpan').innerHTML = ' ' + $("#AllLettersCount").val();
            document.getElementById('AnyLetterSpan').innerHTML = ' ' + $("tbody.NewLettersUl tr").length;
        }
    });
    $("#MoreLetters").click(function () {
        //var pageCount =Number($("#PageNumber").val());
            $.ajax({
            url: "/Home/GetExtraLetters",
            data: { skip: allLetterPageNumber * 50, take: 50 },
            type:"POST",
            success: function (result) {
                
                //pageCount++;
                allLetterPageNumber++;
                $("tbody.NewLettersUl").append(result);
                //$("#PageNumber").val(pageCount);
                document.getElementById('AllLetterSpan').innerHTML = ' ' + $("#AllLettersCount").val();
                document.getElementById('AnyLetterSpan').innerHTML = ' ' + $("tbody.NewLettersUl tr").length;
                if ($("tbody.NewLettersUl tr").length == Number($("#LettersCount").val())) {
                    $("#SpanAllLettersLink").hide()
                }
            }
        })
    })
    $("#AllLettersLink").click(function () {
        //var pageCount = Number($("#PageNumber").val());
        $.ajax({
            url: "/Home/GetExtraLetters",
            data: { skip: allLetterPageNumber * 50, take: -1 },
            type: "POST",
            success: function (result) {
                
                allLetterPageNumber++;
                $("tbody.NewLettersUl").append(result);
                //$("#PageNumber").val(pageCount);
                document.getElementById('AllLetterSpan').innerHTML = ' ' + $("#AllLettersCount").val();
                document.getElementById('AnyLetterSpan').innerHTML = ' ' + $("tbody.NewLettersUl tr").length;
                $("#SpanAllLettersLink").hide();
            }
        })
    })
    
</script>