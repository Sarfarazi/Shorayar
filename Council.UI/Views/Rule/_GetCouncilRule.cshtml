@model IEnumerable<Council.Core.Entities.Letter>
@using Council.UI.Helpers;
@using Council.Core
@using Microsoft.AspNet.Identity;
@using Council.Core.Enums;
@{
    var comNumber = 0;
    var commisions= ViewBag.Commisions as List<Council.Core.Models.CommisionNames>;
}
@{
    Council.Service.PublicMetods publicMethod = new Council.Service.PublicMetods();
}
@foreach (var item in Model)
{
    var commisionName = item.CommissionMeeting != null ? commisions.Where(m => m.Id == item.CommissionMeeting.CommissionId).Select(m => m.Name).SingleOrDefault() : "";

    if (string.IsNullOrEmpty(commisionName))
    {
        <tr class="@(item.LetterStatus == LetterStatus.CommissionEnd ? "white-Color" : item.LetterStatus == LetterStatus.End ? "white-Color" : "" ) @(item.IsRule!=null ? item.IsRule==true?"isRule":"isNotRule":"" )">
            <td>
                <span id="rowNumber">@(++comNumber + Convert.ToInt32(ViewBag.rulePageNumber))</span>
            </td>
            <td>@Html.DisplayFor(modelItem => item.Meeting.MeetingNumber)</td>
            <td class="text-right">
                @*@if (!string.IsNullOrEmpty(commisionName))
                    {
                    <span class="PostText"> [ کمیسیون @commisionName ] &nbsp;&nbsp;</span>
                }*@
                @Html.DisplayFor(modelItem => item.Title)
            </td>

            <td>
                @Html.DisplayFor(modelItem => item.OutLetter.OutLetterNumber)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.CreateOn)
            </td>
            <td>
                @{
                    if (item.LetterStatus == LetterStatus.End)
                    {
                        <a class="btn btn-sm btn-info" href="@Url.Action("LetterItem", "Letter", new { letterID = item.ID })" title="نمایش">
                            نمایش
                        </a>
                    }
                    else
                    {
                        if (item.LetterStatus == LetterStatus.ReadyForVoting)
                        {
                            <span>درمرحله ی صدور اجازه رای گیری</span>
                        }
                        if (item.LetterStatus == LetterStatus.AllowVotting)
                        {
                            <span>در مرحله انجام رای گیری</span>
                        }
                    }

                }
            </td>
        </tr>
    }
}
@{
    <input id="ruleLetterPageNumber" type="hidden" value="1" />
    <input id="ruleLetterCount" type="hidden" value="@ViewBag.ruleLetterCount" />   
}
